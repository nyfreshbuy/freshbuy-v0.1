<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <title>è¿›è´§ / æˆæœ¬ç®¡ç† - åœ¨é²œè´­æ‹¼å¥½è´§åå°</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="stylesheet" href="assets/css/admin.css" />
    <style>
      .form-row {
        display: flex;
        flex-wrap: wrap;
        gap: 8px;
        margin-bottom: 8px;
      }
      .field-block {
        flex: 1 1 260px;
        display: flex;
        flex-direction: column;
        gap: 4px;
      }
      .field-label {
        font-size: 12px;
        color: #e5e7eb;
      }
      .field-help {
        font-size: 11px;
        color: #9ca3af;
      }
      .form-row input,
      .form-row select {
        flex: 1 1 auto;
        padding: 4px 8px;
        border-radius: 10px;
        border: 1px solid rgba(148, 163, 184, 0.6);
        background: rgba(15, 23, 42, 0.9);
        color: #e5e7eb;
        font-size: 12px;
        min-height: 32px;
      }
      .mini-badge {
        display: inline-flex;
        padding: 2px 6px;
        border-radius: 999px;
        background: rgba(148, 163, 184, 0.2);
        font-size: 10px;
        color: #e5e7eb;
      }
    </style>
  </head>
  <body data-page="product-purchase">
    <div class="admin-layout">
      <!-- ä¾§è¾¹æ  -->
      <aside class="admin-sidebar">
      <!-- âœ… ç»Ÿä¸€ sidebarï¼šç”± /admin/assets/js/admin_sidebar.js æ³¨å…¥ -->
      <div id="adminSidebar"></div>
    </aside>
      <!-- ä¸»åŒºåŸŸ -->
      <div class="admin-main">
        <header class="admin-topbar">
          <button class="admin-btn admin-btn-ghost" data-toggle-sidebar>â˜°</button>
          <div class="admin-topbar-title">è¿›è´§ / æˆæœ¬ç®¡ç†</div>
          <div class="admin-topbar-spacer"></div>
          <div class="admin-user">
            <div class="admin-user-avatar">A</div>
            <div class="admin-user-info">
              <span class="admin-user-name">Admin</span>
              <span class="admin-user-role">è¶…çº§ç®¡ç†å‘˜</span>
            </div>
          </div>
        </header>

        <main class="admin-content">
          <!-- é€‰æ‹©å•†å“ -->
          <section class="admin-card admin-card-ghost">
            <div class="admin-card-title">
              é€‰æ‹©å•†å“
              <span class="mini-badge" id="selectedProductInfo">æœªé€‰æ‹©å•†å“</span>
            </div>
            <div style="margin-top:8px;">
              <div class="form-row">
                <div class="field-block">
                  <div class="field-label">å•†å“</div>
                  <select id="purchase_productSelect">
                    <option value="">è¯·é€‰æ‹©å•†å“</option>
                  </select>
                  <div class="field-help">
                    åˆ—è¡¨æ¥è‡ª <code>/api/admin/products</code>ï¼Œé€‰æ‹©åå†å¡«å†™è¿›è´§ä¿¡æ¯ã€‚
                  </div>
                </div>
              </div>
            </div>
          </section>

          <!-- è¿›è´§ / æˆæœ¬è¡¨å• -->
          <section class="admin-card admin-card-ghost" style="margin-top:12px;">
            <div class="admin-card-title">å½•å…¥æœ¬æ¬¡è¿›è´§</div>
            <div style="margin-top:8px;">
              <!-- é‡‘é¢ä¸æ•°é‡ -->
              <div class="form-row">
                <div class="field-block">
                  <div class="field-label">æ•´ç®±è¿›è´§ä»·ï¼ˆæ¯ç®±ï¼‰</div>
                  <input
                    id="pp_boxPrice"
                    type="number"
                    step="0.01"
                    placeholder="ä¾‹å¦‚ï¼š120ï¼Œè¡¨ç¤ºæ¯ç®± 120 ç¾é‡‘"
                  />
                  <div class="field-help">è¿™é‡Œæ˜¯æ¯ä¸€ç®±çš„ä»·æ ¼ã€‚</div>
                </div>

                <div class="field-block">
                  <div class="field-label">æœ¬æ¬¡è¿›è´§ç®±æ•°</div>
                  <input
                    id="pp_boxCount"
                    type="number"
                    step="1"
                    placeholder="ä¾‹å¦‚ï¼š10"
                  />
                  <div class="field-help">æœ¬æ¬¡è¿›äº†å¤šå°‘ç®±ã€‚</div>
                </div>

                <div class="field-block">
                  <div class="field-label">æ¯ç®±å‡ åŒ…</div>
                  <input
                    id="pp_unitsPerBox"
                    type="number"
                    step="1"
                    placeholder="ä¾‹å¦‚ï¼š10"
                  />
                  <div class="field-help">æ¯ç®±é‡Œé¢æœ‰å¤šå°‘åŒ…ã€‚</div>
                </div>

                <div class="field-block">
                  <div class="field-label">æœ¬æ¬¡è¿›è´§æ€»æ•°é‡</div>
                  <input id="pp_totalQty" type="number" step="1" readonly />
                  <div class="field-help">= ç®±æ•° Ã— æ¯ç®±æ•°é‡ï¼ˆç³»ç»Ÿè‡ªåŠ¨è®¡ç®—ï¼‰ã€‚</div>
                </div>
              </div>

              <!-- æˆæœ¬ + æ¯›åˆ© + é›¶å”®ä»· -->
              <div class="form-row">
                <div class="field-block">
                  <div class="field-label">å•åŒ…æˆæœ¬ä»·ï¼ˆè‡ªåŠ¨ï¼‰</div>
                  <input id="pp_unitCost" type="number" step="0.0001" readonly />
                  <div class="field-help">= æ•´ç®±ä»· Ã· æ¯ç®±æ•°é‡ã€‚</div>
                </div>

                <div class="field-block">
                  <div class="field-label">æ¯›åˆ©ç‡ %</div>
                  <input
                    id="pp_margin"
                    type="number"
                    step="1"
                    value="40"
                    placeholder="ä¾‹å¦‚ï¼š40"
                  />
                  <div class="field-help">40 ä»£è¡¨ 40% æ¯›åˆ©ï¼Œå¯ä»¥è‡ªå·±è°ƒæ•´ã€‚</div>
                </div>

                <div class="field-block">
                  <div class="field-label">é›¶å”®ä»·ï¼ˆå¯ç¼–è¾‘ï¼‰</div>
                  <input
                    id="pp_retailPrice"
                    type="number"
                    step="0.01"
                    placeholder="è‡ªåŠ¨è®¡ç®—ï¼Œä¹Ÿå¯ä»¥æ‰‹åŠ¨æ”¹"
                  />
                  <div class="field-help">
                    ç³»ç»Ÿä¼šæ ¹æ®æˆæœ¬å’Œæ¯›åˆ©ç‡ç»™ä¸€ä¸ªå»ºè®®ä»·ï¼Œä½ å¯ä»¥ç›´æ¥ä¿®æ”¹ã€‚
                  </div>
                </div>

                <div class="field-block">
                  <div class="field-label">æœ¬æ¬¡è¿›è´§æ€»æˆæœ¬ï¼ˆåªè¯»ï¼‰</div>
                  <input id="pp_totalCost" type="number" step="0.01" readonly />
                  <div class="field-help">= å•åŒ…æˆæœ¬ Ã— æ€»æ•°é‡ã€‚</div>
                </div>
              </div>

              <!-- ä¾›åº”å•† + è¿‡æœŸæ—¥ -->
              <div class="form-row">
                <div class="field-block">
                  <div class="field-label">è¿›è´§å…¬å¸ / ä¾›åº”å•†</div>
                  <input
                    id="pp_supplier"
                    placeholder="ä¾‹å¦‚ï¼šXX é£Ÿå“æ‰¹å‘ / XX å†œåœº"
                  />
                  <div class="field-help">æ–¹ä¾¿ä»¥åæŸ¥å¯¹åº”ä¾›è´§å•†ã€‚</div>
                </div>

                <div class="field-block">
                  <div class="field-label">è¯¥æ‰¹æ¬¡è¿‡æœŸæ—¶é—´ï¼ˆå¯é€‰ï¼‰</div>
                  <input id="pp_expiry" type="date" />
                  <div class="field-help">å¯ç”¨äºåç»­åšä¸´æœŸæé†’ã€‚</div>
                </div>

                <div class="field-block">
                  <div class="field-label">è¯¥æ‰¹æ¬¡æœªå”®å®Œåº“å­˜ï¼ˆåˆå§‹=æ€»æ•°é‡ï¼‰</div>
                  <input id="pp_remainingQty" type="number" step="1" readonly />
                  <div class="field-help">
                    ä¿å­˜æ—¶é»˜è®¤ç­‰äºæœ¬æ¬¡è¿›è´§æ€»æ•°é‡ï¼Œåç»­å‡ºè´§æ—¶å¯åœ¨åç«¯é€æ­¥æ‰£å‡ã€‚
                  </div>
                </div>
              </div>

              <!-- æŒ‰é’® -->
              <div style="margin-top:4px; display:flex; gap:8px;">
                <button class="admin-btn admin-btn-ghost" type="button" id="pp_btnCalcRetail">
                  ğŸ§® é‡æ–°æ ¹æ®æ¯›åˆ©ç‡è®¡ç®—é›¶å”®ä»·
                </button>
                <button class="admin-btn admin-btn-primary" type="button" id="pp_btnSaveBatch">
                  ğŸ“¦ ä¿å­˜æœ¬æ¬¡è¿›è´§ï¼ˆå åŠ åº“å­˜ + è®°å½•æ‰¹æ¬¡ï¼‰
                </button>
              </div>
            </div>
          </section>

          <!-- æ‰¹æ¬¡è®°å½• -->
          <section class="admin-table-card" style="margin-top:12px;">
            <div class="admin-card-header">
              <div>
                <div class="admin-card-header-title">è¯¥å•†å“çš„è¿›è´§æ‰¹æ¬¡è®°å½•</div>
                <div class="admin-card-header-sub">
                  ä» <code>/api/admin/products/:id/purchase-batches</code> æ‹‰å–æ•°æ®ã€‚
                </div>
              </div>
              <div id="pp_batchSummary" style="font-size:12px;color:#e5e7eb;">
                å½“å‰æ— æ‰¹æ¬¡è®°å½•
              </div>
            </div>

            <div class="admin-table-wrapper">
              <table class="admin-table">
                <thead>
                  <tr>
                    <th>æ—¶é—´</th>
                    <th>ä¾›åº”å•†</th>
                    <th>æ•´ç®±ä»·</th>
                    <th>ç®±æ•°</th>
                    <th>æ¯ç®±æ•°é‡</th>
                    <th>å•åŒ…æˆæœ¬</th>
                    <th>æ€»æ•°é‡</th>
                    <th>æœªå”®å®Œ</th>
                    <th>é›¶å”®ä»·</th>
                    <th>è¿‡æœŸæ—¥æœŸ</th>
                  </tr>
                </thead>
                <tbody id="pp_batchTableBody">
                  <tr><td colspan="10">è¯·é€‰æ‹©ä¸Šæ–¹å•†å“åæŸ¥çœ‹è®°å½•</td></tr>
                </tbody>
              </table>
            </div>
          </section>
        </main>
      </div>
    </div>
    <script src="/admin/assets/js/admin_guard.js"></script>
    <script src="./assets/js/admin_auth_ui.js"></script>
    <script src="assets/js/admin.js"></script>
    <script>
      let pp_products = [];
      let pp_currentProductId = null;

      function pp_formatDate(dtStr) {
        if (!dtStr) return "â€”";
        const d = new Date(dtStr);
        if (Number.isNaN(d.getTime())) return "â€”";
        const pad = (n) => (n < 10 ? "0" + n : "" + n);
        return (
          d.getFullYear() +
          "-" +
          pad(d.getMonth() + 1) +
          "-" +
          pad(d.getDate()) +
          " " +
          pad(d.getHours()) +
          ":" +
          pad(d.getMinutes())
        );
      }

      function pp_calcDerivedFields() {
        const boxPrice = Number(document.getElementById("pp_boxPrice").value || 0);
        const boxCount = Number(document.getElementById("pp_boxCount").value || 0);
        const unitsPerBox = Number(
          document.getElementById("pp_unitsPerBox").value || 0
        );
        const totalQtyEl = document.getElementById("pp_totalQty");
        const unitCostEl = document.getElementById("pp_unitCost");
        const totalCostEl = document.getElementById("pp_totalCost");
        const remainingEl = document.getElementById("pp_remainingQty");

        let totalQty = 0;
        let unitCost = 0;
        let totalCost = 0;

        if (unitsPerBox > 0) {
          unitCost = boxPrice / unitsPerBox;
        }
        if (boxCount > 0 && unitsPerBox > 0) {
          totalQty = boxCount * unitsPerBox;
        }
        totalCost = unitCost * totalQty;

        totalQtyEl.value = totalQty || "";
        unitCostEl.value = unitCost ? unitCost.toFixed(4) : "";
        totalCostEl.value = totalCost ? totalCost.toFixed(2) : "";
        remainingEl.value = totalQty || "";
      }

      function pp_calcRetailFromMargin() {
        const unitCost = Number(document.getElementById("pp_unitCost").value || 0);
        const marginPercent = Number(
          document.getElementById("pp_margin").value || 40
        );
        const retailEl = document.getElementById("pp_retailPrice");
        if (!unitCost || unitCost <= 0) {
          alert("è¯·å…ˆå¡«å¥½æ•´ç®±ä»·å’Œæ¯ç®±æ•°é‡ï¼Œè®©ç³»ç»Ÿç®—å‡ºå•åŒ…æˆæœ¬ä»·ã€‚");
          return;
        }
        if (!marginPercent || marginPercent <= 0 || marginPercent >= 100) {
          alert("æ¯›åˆ©ç‡å¿…é¡»åœ¨ 0~100 ä¹‹é—´ï¼Œä¾‹å¦‚ 40ã€‚");
          return;
        }
        const rate = marginPercent / 100;
        const retail = unitCost / (1 - rate);
        retailEl.value = (Math.round(retail * 100) / 100).toFixed(2);
      }

      async function pp_loadProducts() {
        const sel = document.getElementById("purchase_productSelect");
        sel.innerHTML = '<option value="">æ­£åœ¨åŠ è½½å•†å“...</option>';
        try {
          const res = await fetch("/api/admin/products");
          const data = await res.json();
          if (!data.success) {
            sel.innerHTML =
              '<option value="">å•†å“åŠ è½½å¤±è´¥ï¼š' +
              (data.message || "æœªçŸ¥é”™è¯¯") +
              "</option>";
            return;
          }
          const list = data.list || data.products || [];
          pp_products = list;
          if (!list.length) {
            sel.innerHTML = '<option value="">æš‚æ— å•†å“</option>';
            return;
          }
          sel.innerHTML = '<option value="">è¯·é€‰æ‹©å•†å“</option>';
          list.forEach((p) => {
            const opt = document.createElement("option");
            opt.value = p.id;
            opt.textContent =
              p.name + (p.sku ? "ï¼ˆSKU: " + p.sku + "ï¼‰" : "");
            sel.appendChild(opt);
          });

          // å¦‚æœ URL ä¸Šå¸¦ ?productId=xxx å°±è‡ªåŠ¨é€‰ä¸­
          const url = new URL(window.location.href);
          const pid = url.searchParams.get("productId");
          if (pid) {
            sel.value = pid;
            pp_onProductChange();
          }
        } catch (e) {
          console.error(e);
          sel.innerHTML = '<option value="">è¯·æ±‚é”™è¯¯ï¼Œè¯·æ£€æŸ¥æ¥å£</option>';
        }
      }

      async function pp_loadBatches(productId) {
        const tbody = document.getElementById("pp_batchTableBody");
        const summary = document.getElementById("pp_batchSummary");
        tbody.innerHTML = '<tr><td colspan="10">æ­£åœ¨åŠ è½½æ‰¹æ¬¡è®°å½•...</td></tr>';
        try {
          const res = await fetch(
            "/api/admin/products/" + productId + "/purchase-batches"
          );
          const data = await res.json();
          if (!data.success) {
            tbody.innerHTML =
              '<tr><td colspan="10">åŠ è½½å¤±è´¥ï¼š' +
              (data.message || "æœªçŸ¥é”™è¯¯") +
              "</td></tr>";
            summary.textContent = "å½“å‰æ— æ‰¹æ¬¡è®°å½•";
            return;
          }
          const list = data.list || [];
          if (!list.length) {
            tbody.innerHTML =
              '<tr><td colspan="10">å½“å‰å•†å“æš‚æ— è¿›è´§æ‰¹æ¬¡è®°å½•</td></tr>';
            summary.textContent = "å½“å‰æ— æ‰¹æ¬¡è®°å½•";
            return;
          }

          let totalRemain = 0;
          tbody.innerHTML = "";
          list.forEach((b) => {
            const tr = document.createElement("tr");
            totalRemain += Number(b.remainingQty || 0);

            tr.innerHTML = `
              <td>${pp_formatDate(b.createdAt)}</td>
              <td>${b.supplier || "â€”"}</td>
              <td>$${Number(b.boxPrice || 0).toFixed(2)}</td>
              <td>${b.boxCount || 0}</td>
              <td>${b.unitsPerBox || 0}</td>
              <td>$${Number(b.unitCost || 0).toFixed(4)}</td>
              <td>${b.totalQty || 0}</td>
              <td>${b.remainingQty || 0}</td>
              <td>$${Number(b.retailPrice || 0).toFixed(2)}</td>
              <td>${b.expiryDate ? b.expiryDate.slice(0, 10) : "â€”"}</td>
            `;
            tbody.appendChild(tr);
          });

          summary.textContent =
            "å…± " + list.length + " ä¸ªæ‰¹æ¬¡ï¼Œåˆè®¡æœªå”®å®Œåº“å­˜ " + totalRemain;
        } catch (e) {
          console.error(e);
          tbody.innerHTML =
            '<tr><td colspan="10">è¯·æ±‚å‡ºé”™ï¼Œè¯·æ£€æŸ¥ /purchase-batches æ¥å£</td></tr>';
          summary.textContent = "å½“å‰æ— æ‰¹æ¬¡è®°å½•";
        }
      }

      function pp_onProductChange() {
        const sel = document.getElementById("purchase_productSelect");
        const id = sel.value;
        const info = document.getElementById("selectedProductInfo");
        pp_currentProductId = id || null;
        if (!id) {
          info.textContent = "æœªé€‰æ‹©å•†å“";
          document.getElementById("pp_batchTableBody").innerHTML =
            '<tr><td colspan="10">è¯·é€‰æ‹©ä¸Šæ–¹å•†å“åæŸ¥çœ‹è®°å½•</td></tr>';
          document.getElementById("pp_batchSummary").textContent = "å½“å‰æ— æ‰¹æ¬¡è®°å½•";
          return;
        }
        const p = pp_products.find((x) => x.id === id);
        info.textContent = p
          ? `å·²é€‰ï¼š${p.name}ï¼ˆåº“å­˜ï¼š${p.stock || 0}ï¼ŒåŸä»·ï¼š$${Number(
              p.originPrice || 0
            ).toFixed(2)}ï¼‰`
          : "å·²é€‰å•†å“IDï¼š" + id;
        // åˆå§‹åŒ–è¡¨å•
        document.getElementById("pp_boxPrice").value = "";
        document.getElementById("pp_boxCount").value = "";
        document.getElementById("pp_unitsPerBox").value = "";
        document.getElementById("pp_totalQty").value = "";
        document.getElementById("pp_unitCost").value = "";
        document.getElementById("pp_totalCost").value = "";
        document.getElementById("pp_supplier").value = "";
        document.getElementById("pp_expiry").value = "";
        document.getElementById("pp_remainingQty").value = "";
        document.getElementById("pp_margin").value = "40";
        document.getElementById("pp_retailPrice").value =
          p && p.originPrice ? p.originPrice : "";

        pp_loadBatches(id);
      }

      async function pp_saveBatch() {
        if (!pp_currentProductId) {
          alert("è¯·å…ˆé€‰æ‹©ä¸€ä¸ªå•†å“");
          return;
        }
        const boxPrice = Number(document.getElementById("pp_boxPrice").value || 0);
        const boxCount = Number(document.getElementById("pp_boxCount").value || 0);
        const unitsPerBox = Number(
          document.getElementById("pp_unitsPerBox").value || 0
        );
        const totalQty = Number(document.getElementById("pp_totalQty").value || 0);
        const unitCost = Number(document.getElementById("pp_unitCost").value || 0);
        const totalCost = Number(document.getElementById("pp_totalCost").value || 0);
        const marginPercent = Number(
          document.getElementById("pp_margin").value || 40
        );
        const retailPriceRaw =
          document.getElementById("pp_retailPrice").value || "";
        const supplier = document.getElementById("pp_supplier").value.trim();
        const expiryVal = document.getElementById("pp_expiry").value;

        if (!boxPrice || boxPrice <= 0) {
          alert("è¯·å¡«å†™æ­£ç¡®çš„æ•´ç®±è¿›è´§ä»·");
          return;
        }
        if (!boxCount || boxCount <= 0 || !unitsPerBox || unitsPerBox <= 0) {
          alert("è¯·å¡«å†™æœ¬æ¬¡è¿›è´§ç®±æ•°å’Œæ¯ç®±æ•°é‡ï¼ˆéƒ½è¦å¤§äº 0ï¼‰");
          return;
        }
        if (!totalQty || totalQty <= 0) {
          alert("æœ¬æ¬¡è¿›è´§æ€»æ•°é‡ä¸º 0ï¼Œè¯·æ£€æŸ¥ç®±æ•°å’Œæ¯ç®±æ•°é‡");
          return;
        }
        if (!unitCost || unitCost <= 0) {
          alert("å•åŒ…æˆæœ¬è®¡ç®—æœ‰é—®é¢˜ï¼Œè¯·æ£€æŸ¥æ•´ç®±ä»·å’Œæ¯ç®±æ•°é‡");
          return;
        }

        let retailPrice = Number(retailPriceRaw);
        if (!retailPrice || retailPrice <= 0) {
          // å¦‚æœé›¶å”®ä»·æ²¡å¡«ï¼Œå°±æ ¹æ®æ¯›åˆ©ç‡ç®—ä¸€ä¸ª
          if (!marginPercent || marginPercent <= 0 || marginPercent >= 100) {
            alert(
              "é›¶å”®ä»·æœªå¡«å†™ä¸”æ¯›åˆ©ç‡ä¸åˆæ³•ï¼Œè¯·å¡«ä¸€ä¸ªé›¶å”®ä»·æˆ–è€…æœ‰æ•ˆæ¯›åˆ©ç‡ï¼ˆ0~100ï¼‰"
            );
            return;
          }
          const rate = marginPercent / 100;
          retailPrice = unitCost / (1 - rate);
        }

        const body = {
          boxPrice,
          boxCount,
          unitsPerBox,
          totalQty,
          unitCost,
          totalCost,
          retailPrice,
          marginPercent,
          supplier,
          expiryDate: expiryVal ? new Date(expiryVal).toISOString() : null,
        };

        try {
          const res = await fetch(
            "/api/admin/products/" +
              pp_currentProductId +
              "/purchase-batches",
            {
              method: "POST",
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify(body),
            }
          );
          const data = await res.json();
          if (!data.success) {
            alert("ä¿å­˜è¿›è´§æ‰¹æ¬¡å¤±è´¥ï¼š" + (data.message || "æœªçŸ¥é”™è¯¯"));
            return;
          }
          alert("è¿›è´§æ‰¹æ¬¡å·²ä¿å­˜ï¼Œåº“å­˜å·²å åŠ ï¼Œå•†å“åŸä»·å·²æ›´æ–°ä¸ºæ–°é›¶å”®ä»·ã€‚");

          // é‡æ–°æ‹‰ä¸€æ¬¡å•†å“ï¼Œæ›´æ–°å³ä¸Šè§’ä¿¡æ¯ï¼ˆåº“å­˜ã€åŸä»·ï¼‰
          await pp_loadProducts();
          const sel = document.getElementById("purchase_productSelect");
          sel.value = pp_currentProductId;
          pp_onProductChange();
        } catch (e) {
          console.error(e);
          alert(
            "è¯·æ±‚å¤±è´¥ï¼Œè¯·æ£€æŸ¥ /api/admin/products/:id/purchase-batches POST æ¥å£"
          );
        }
      }

      window.addEventListener("DOMContentLoaded", () => {
        pp_loadProducts();

        document
          .getElementById("purchase_productSelect")
          .addEventListener("change", pp_onProductChange);

        document
          .getElementById("pp_boxPrice")
          .addEventListener("input", pp_calcDerivedFields);
        document
          .getElementById("pp_boxCount")
          .addEventListener("input", pp_calcDerivedFields);
        document
          .getElementById("pp_unitsPerBox")
          .addEventListener("input", pp_calcDerivedFields);

        document
          .getElementById("pp_btnCalcRetail")
          .addEventListener("click", pp_calcRetailFromMargin);

        document
          .getElementById("pp_btnSaveBatch")
          .addEventListener("click", pp_saveBatch);
      });
    </script>
  <!-- âœ… ç»Ÿä¸€ sidebar æ³¨å…¥è„šæœ¬ï¼ˆå¿…é¡»åŠ ï¼‰ -->
    <script src="/admin/assets/js/admin_sidebar.js"></script>
</body>
</html>
