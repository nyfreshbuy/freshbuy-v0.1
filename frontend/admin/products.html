<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <title>商品管理 - 在鲜购拼好货后台</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <!-- 后台通用样式 -->
    <link rel="stylesheet" href="assets/css/admin.css" />

    <style>
      .tag-pill {
        display: inline-flex;
        padding: 2px 8px;
        border-radius: 999px;
        background: rgba(52, 211, 153, 0.1);
        color: #6ee7b7;
        font-size: 11px;
      }
      .type-pill {
        display: inline-flex;
        padding: 2px 8px;
        border-radius: 999px;
        background: rgba(59, 130, 246, 0.1);
        color: #93c5fd;
        font-size: 11px;
      }

      .form-row {
        display: flex;
        flex-wrap: wrap;
        gap: 8px;
        margin-bottom: 8px;
      }
      .field-block {
        flex: 1 1 260px;
        display: flex;
        flex-direction: column;
        gap: 4px;
      }
      .field-label {
        font-size: 12px;
        color: #e5e7eb;
      }
      .field-help {
        font-size: 11px;
        color: #9ca3af;
      }
      .form-row input,
      .form-row select {
        flex: 1 1 auto;
        padding: 4px 8px;
        border-radius: 10px;
        border: 1px solid rgba(148, 163, 184, 0.6);
        background: rgba(15, 23, 42, 0.9);
        color: #e5e7eb;
        font-size: 12px;
        min-height: 32px;
      }
      .desc-input {
        width: 100%;
        border-radius: 10px;
      }
      .inline-edit-input {
        width: 80px;
        padding: 2px 4px;
        border-radius: 6px;
        border: 1px solid rgba(148, 163, 184, 0.7);
        background: rgba(15, 23, 42, 0.85);
        color: #e5e7eb;
        font-size: 11px;
      }

      /* 编辑总面板 */
      .product-editor-panel {
        margin-top: 12px;
        display: none; /* 默认隐藏，点击按钮才出现 */
      }
      .editor-panel-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 8px;
      }
      .editor-panel-title {
        font-size: 14px;
        font-weight: 600;
        color: #e5e7eb;
      }
      .editor-panel-hint {
        font-size: 11px;
        color: #9ca3af;
        margin-left: 8px;
      }
      .pill-muted {
        display: inline-flex;
        align-items: center;
        padding: 2px 8px;
        border-radius: 999px;
        border: 1px solid rgba(148, 163, 184, 0.3);
        font-size: 11px;
        color: #9ca3af;
      }

      .editor-section-title {
        font-size: 13px;
        font-weight: 600;
        margin-bottom: 6px;
        color: #e5e7eb;
      }
      .editor-section-subtitle {
        font-size: 11px;
        color: #9ca3af;
        margin-bottom: 8px;
      }

      /* tab 按钮 */
      .editor-tabs {
        display: inline-flex;
        padding: 2px;
        border-radius: 999px;
        background: rgba(15, 23, 42, 0.9);
        border: 1px solid rgba(148, 163, 184, 0.5);
        gap: 4px;
      }
      .editor-tab-btn {
        border: none;
        background: transparent;
        font-size: 12px;
        padding: 4px 10px;
        border-radius: 999px;
        color: #9ca3af;
        cursor: pointer;
      }
      .editor-tab-btn.active {
        background: linear-gradient(135deg, #22c55e, #4ade80);
        color: #0f172a;
        font-weight: 600;
      }

      /* 进货摘要、表格 */
      .purchase-summary {
        font-size: 11px;
        color: #e5e7eb;
        padding: 6px 8px;
        border-radius: 10px;
        background: rgba(15, 23, 42, 0.9);
        border: 1px dashed rgba(148, 163, 184, 0.6);
        margin-bottom: 8px;
      }
      .purchase-summary b {
        color: #facc15;
      }
      .purchase-table-wrapper {
        max-height: 260px;
        overflow: auto;
        margin-top: 6px;
        border-radius: 10px;
        border: 1px solid rgba(31, 41, 55, 0.8);
      }
      .purchase-table {
        width: 100%;
        border-collapse: collapse;
        font-size: 11px;
      }
      .purchase-table th,
      .purchase-table td {
        padding: 4px 6px;
        border-bottom: 1px solid rgba(31, 41, 55, 0.8);
        white-space: nowrap;
      }
      .purchase-table th {
        position: sticky;
        top: 0;
        background: rgba(15, 23, 42, 0.98);
        z-index: 1;
        font-weight: 500;
        color: #9ca3af;
      }
    </style>
  </head>

  <body data-page="products">
    <div class="admin-layout">
      <!-- 侧边栏 -->
      <aside class="admin-sidebar">
      <!-- ✅ 统一 sidebar：由 /admin/assets/js/admin_sidebar.js 注入 -->
      <div id="adminSidebar"></div>
    </aside>
      <!-- 主区域 -->
      <div class="admin-main">
        <!-- 顶部栏 -->
        <header class="admin-topbar">
          <button class="admin-btn admin-btn-ghost" data-toggle-sidebar>☰</button>

          <div class="admin-topbar-title">商品管理</div>
          <div class="admin-topbar-spacer"></div>

          <div class="admin-search">
            <span class="admin-search-icon">🔍</span>
            <input
              type="text"
              id="searchKeyword"
              placeholder="搜索商品ID / 名称 / 进货公司ID / 内部ID / 标签..."
            />
          </div>

          <div class="admin-user">
            <div class="admin-user-avatar">A</div>
            <div class="admin-user-info">
              <span class="admin-user-name">Admin</span>
              <span class="admin-user-role">超级管理员</span>
            </div>
          </div>
        </header>

        <!-- 内容 -->
        <main class="admin-content">
          <!-- 标题行 -->
          <div class="admin-page-header">
            <div>
              <div class="admin-page-title">商品列表</div>
              <div class="admin-breadcrumb">后台 &gt; 商品管理</div>
            </div>

            <div class="admin-page-actions">
              <button class="admin-btn admin-btn-ghost" id="btnRefresh">⟳ 刷新</button>
              <button class="admin-btn admin-btn-primary" id="btnOpenNewEditor">
                ＋ 新增 / 编辑商品
              </button>
            </div>
          </div>

          <!-- 商品表格 -->
          <section class="admin-table-card" style="margin-top: 12px">
            <div class="admin-card-header">
              <div>
                <div class="admin-card-header-title">商品列表</div>
                <div class="admin-card-header-sub">
                  从 <code>/api/admin/products</code>
                  拉取数据（目前为内存版，重启会恢复初始数据）。
                </div>
              </div>

              <div id="productSummary" style="font-size: 12px; color: #e5e7eb">
                共 0 个商品
              </div>
            </div>

            <div class="admin-table-wrapper">
              <table class="admin-table">
                <thead>
                  <tr>
                    <th>商品ID</th>
                    <th>图片</th>
                    <th>名称</th>
                    <th>分类</th>
                    <th>类型</th>
                    <th>标签</th>
                    <th>特价</th>
                    <th>原价</th>
                    <th>库存</th>
                    <th>状态</th>
                    <th>操作</th>
                  </tr>
                </thead>
                <tbody id="productTableBody">
                  <tr>
                    <td colspan="11">正在加载商品...</td>
                  </tr>
                </tbody>
              </table>
            </div>

            <div class="admin-pagination">
              <span id="productCountText">共 0 条</span>
            </div>
          </section>

          <!-- 编辑商品 + 进货成本管理（tab 切换） -->
          <section
            class="admin-card admin-card-ghost product-editor-panel"
            id="productEditorPanel"
          >
            <div class="editor-panel-header">
              <div>
                <span class="editor-panel-title">商品详情</span>
                <span id="editHint" class="editor-panel-hint">
                  当前模式：新增商品
                </span>
              </div>

              <div style="display:flex;gap:8px;align-items:center;">
                <div class="editor-tabs">
                  <button
                    type="button"
                    class="editor-tab-btn active"
                    id="tabBtnBasic"
                  >
                    商品信息
                  </button>
                  <button
                    type="button"
                    class="editor-tab-btn"
                    id="tabBtnPurchase"
                  >
                    进货 / 成本管理
                  </button>
                </div>

                <span
                  id="currentEditingInfo"
                  class="pill-muted"
                  style="display:none;"
                ></span>

                <button
                  class="admin-btn admin-btn-ghost"
                  id="btnCloseEditor"
                  type="button"
                >
                  ✕ 收起
                </button>
              </div>
            </div>

            <!-- tab: 商品信息 -->
            <div id="editorTabBasic">
              <div class="editor-section-title">新增 / 编辑商品</div>
              <div class="editor-section-subtitle">
                这里只专注商品本身的信息，保存成功后再去右侧 tab 录入进货成本。
              </div>

              <div style="margin-top: 4px">
                <!-- 基本信息 -->
                <div class="form-row">
                  <div class="field-block">
                    <div class="field-label">商品名称</div>
                    <input id="p_name" placeholder="例如：十枚装新鲜鸡蛋" />
                    <div class="field-help">
                      客户在前台看到的名称，尽量简单清晰。
                    </div>
                  </div>

                  <div class="field-block">
                    <div class="field-label">原价（必填）</div>
                    <input
                      id="p_originPrice"
                      type="number"
                      step="0.01"
                      placeholder="例如：3.99"
                    />
                    <div class="field-help">
                      平时正常售价，用于计算特价和毛利。进货成本核算出来的零售价也会同步到这里。
                    </div>
                  </div>
                </div>
                <!-- ✅ 是否收税（NY） -->
<div class="form-row">
  <label class="form-label" style="display:flex; gap:10px; align-items:center;">
    <input type="checkbox" id="p_taxable" />
    <span>是否收税（NY 销售税）</span>
  </label>
  <div class="form-hint">勾选后：当收货地址州为 NY 时，该商品参与计算销售税</div>
</div>

                <!-- 特价开关 + 特价设置区域 -->
                <div class="form-row">
                  <label style="font-size: 12px; color: #e5e7eb;">
                    <input type="checkbox" id="p_hasSpecial" />
                    启用特价（家庭必备）
                  </label>
                </div>

                <div class="form-row" id="specialArea">
                  <div class="field-block">
  <div class="field-label">特价数量（N）</div>
  <input
    id="p_specialQty"
    type="number"
    step="1"
    min="1"
    placeholder="例如：2"
  />
  <div class="field-help">
    例如：填 2 表示「2 个/份」参与特价；不填或填 1 表示单件特价。
  </div>
</div>

<div class="field-block">
  <div class="field-label">特价总价（$）</div>
  <input
    id="p_specialTotalPrice"
    type="number"
    step="0.01"
    placeholder="例如：4.98"
  />
  <div class="field-help">
    例如：2 个 $4.98；如果只想 1 个 $4.98，就填数量 1、总价 4.98。
  </div>
</div>
                  <div class="field-block">
                    <div class="field-label">特价开始时间（可选）</div>
                    <input id="p_specialFrom" type="datetime-local" />
                    <div class="field-help">留空表示立即生效。</div>
                  </div>

                  <div class="field-block">
                    <div class="field-label">特价结束时间（可选）</div>
                    <input id="p_specialTo" type="datetime-local" />
                    <div class="field-help">
                      留空表示特价一直有效，直到你手动关闭。
                    </div>
                  </div>
                </div>

                <!-- 库存保护 -->
                <div class="form-row">
                  <div class="field-block">
                    <div class="field-label">自动取消特价（库存保护）</div>
                    <label style="font-size:12px;color:#e5e7eb;">
                      <input type="checkbox" id="p_autoCancelSpecial" />
                      当库存低于下方设置的数量时，自动关闭特价
                    </label>
                    <div class="field-help">
                      例如设为 20，则库存 ≤ 20 时系统会自动把特价关掉。
                    </div>
                  </div>

                  <div class="field-block">
                    <div class="field-label">库存保护阈值</div>
                    <input
                      id="p_autoCancelSpecialThreshold"
                      type="number"
                      step="1"
                      placeholder="例如：20"
                      disabled
                    />
                    <div class="field-help">
                      只有开启库存保护后才可填写，大于 0 的整数。
                    </div>
                  </div>
                </div>

                <!-- 公司内部ID + SKU -->
                <div class="form-row">
                  <div class="field-block">
                    <div class="field-label">公司内部 ID</div>
                    <input
                      id="p_internalCompanyId"
                      placeholder="例如：内部系统里的 SKU ID"
                    />
                    <div class="field-help">
                      你自己公司内部用的 ID，支持在搜索框直接搜索。
                    </div>
                  </div>

                  <div class="field-block">
                    <div class="field-label">SKU（可选）</div>
                    <input id="p_sku" placeholder="例如：FRU-BAN-2LB" />
                    <div class="field-help">方便你内部识别商品，可不填。</div>
                  </div>
                </div>

                <!-- 图片管理：URL + 本地上传 + 预览 -->
                <div class="form-row">
                  <div class="field-block">
                    <div class="field-label">封面图片 URL</div>
                    <input
                      id="p_imageUrl"
                      placeholder="可手动粘贴 http 链接，留空则用下方上传"
                    />
                  </div>
                  <div class="field-block">
                    <div class="field-label">上传封面图片</div>
                    <input
                      id="p_imageFile"
                      type="file"
                      accept="image/*"
                      style="background: transparent; border-radius: 10px"
                    />
                    <div class="field-help">支持本地上传一张作为封面。</div>
                  </div>
                </div>

                <div class="form-row" style="align-items: center; gap: 12px">
                  <div class="field-block" style="max-width: 260px;">
                    <div class="field-label">封面预览</div>
                    <img
                      id="p_imagePreview"
                      src=""
                      alt="预览"
                      style="max-height: 60px; border-radius: 8px; display: none"
                    />
                  </div>
                </div>

                <!-- 多图 -->
                <div class="form-row">
                  <div class="field-block" style="flex: 1 1 100%;">
                    <div class="field-label">多图 URL（可选）</div>
                    <input
                      id="p_images"
                      class="desc-input"
                      placeholder="多张图片用英文逗号分隔，例如：url1,url2,url3"
                    />
                    <div class="field-help">前台详情页可以轮播多张图片。</div>
                  </div>
                </div>

                <!-- 标签 + 类型 + 库存 -->
                <div class="form-row">
                  <div class="field-block">
                    <div class="field-label">标签</div>
                    <input id="p_tag" placeholder="如：爆品 / 日常家用" />
                    <div class="field-help">只在后台使用，方便你自己筛选。</div>
                  </div>

                  <div class="field-block">
                    <div class="field-label">商品类型</div>
                    <select id="p_type">
                      <option value="">默认 normal</option>
                      <option value="hot">hot - 本周爆品</option>
                      <option value="daily">daily - 日常家用特价</option>
                      <option value="new">new - 新品上市</option>
                      <option value="best">best - 畅销产品</option>
                      <option value="normal">normal - 日常商品</option>
                    </select>
                  </div>

                  <div class="field-block">
                    <div class="field-label">库存数量（可选）</div>
                    <input id="p_stock" type="number" step="1" placeholder="例如：100" />
                    <div class="field-help">
                      默认 0 也可以下单，适合团购先收单后进货。
                    </div>
                  </div>

                  <div class="field-block">
                    <div class="field-label">最低库存提醒</div>
                    <input
                      id="p_minStock"
                      type="number"
                      step="1"
                      placeholder="低于此值红色预警"
                    />
                  </div>
                </div>
                <!-- =========================
✅ 规格（variants）：单个/整箱（共用库存）
========================= -->
<div class="form-row" style="margin-top:10px;">
  <div class="field-block" style="flex: 1 1 100%;">
    <div class="field-label">规格（单个 / 整箱）</div>
    <div class="field-help">
      单个/整箱共用一个库存（stock 以“单个”为基础单位）。
      例：整箱 12 个，则 unitCount=12；卖 1 箱会扣 12 个库存。
    </div>

    <div
      id="variantsEditor"
      style="margin-top:8px;display:flex;flex-direction:column;gap:8px;"
    >
      <!-- JS 会动态渲染每一行 -->
    </div>

    <div style="display:flex;gap:8px;margin-top:8px;flex-wrap:wrap;">
      <button type="button" class="admin-btn admin-btn-ghost" id="btnAddVariant">
        ＋ 添加规格
      </button>
      <span style="font-size:11px;color:#9ca3af;">
        建议至少保留 single（单个）和 box12（整箱 12）。
      </span>
    </div>
  </div>
</div>
                <div class="form-row">
                  <label style="font-size: 12px; color: #e5e7eb;">
                    <input type="checkbox" id="p_allowZeroStock" checked />
                    允许库存为 0 时继续下单（适合团购先收单后进货）
                  </label>
                </div>
                <!-- 首页导航大类（顶栏用的） -->
              
<div class="form-row">
  <div class="field-block">
    <div class="field-label">导航大类（首页顶部分类）</div>
    <select id="p_topCategoryKey">
      <option value="">（不设置 / 默认）</option>
      <option value="fresh">生鲜果蔬</option>
      <option value="meat">肉禽海鲜</option>
      <option value="snacks">零食饮品</option>
      <option value="staples">粮油主食</option>
      <option value="seasoning">调味酱料</option>
      <option value="frozen">冷冻食品</option>
      <option value="household">日用清洁</option>
    </select>
    <div class="field-help">
      这里只控制“点击首页顶部的商品大类时，这个商品会出现在哪个分类页”。
    </div>
  </div>
</div>

                <!-- 分类管理 -->
                <div class="form-row">
                  <div class="field-block">
                    <div class="field-label">商品大类</div>
                    <input
                      id="p_category"
                      list="categoryList"
                      placeholder="例如：水果 / 蔬菜 / 日用品，也可以直接输入新品类"
                    />
                    <!-- 选项由 products.js 中的 defaultCategories + 已有商品动态填充 -->
                    <datalist id="categoryList"></datalist>
                    <div class="field-help">
                      既可以从下拉选择，也可以直接输入一个全新的大类。
                    </div>
                  </div>

                  <div class="field-block">
                    <div class="field-label">子分类（可选）</div>
                    <input
                      id="p_subCategory"
                      list="subCategoryList"
                      placeholder="例如：叶菜类 / 蛋制品 / 饮料，也可以自定义"
                    />
                    <datalist id="subCategoryList"></datalist>
                    <div class="field-help">
                      子分类同样支持自由输入，系统会记住你用过的。
                    </div>
                  </div>

                  <div class="field-block">
                    <div class="field-label">排序值</div>
                    <input id="p_sortOrder" type="number" placeholder="数字越小越靠前" />
                  </div>
                </div>

                <!-- 前台展示标签 -->
                <div class="form-row" style="flex-wrap: wrap;">
                  <label
                    style="font-size: 12px; color: #e5e7eb; margin-right: 10px;"
                  >
                    <input type="checkbox" id="p_isFlashDeal" />
                    爆品日
                  </label>
                  <label
                    style="font-size: 12px; color: #e5e7eb; margin-right: 10px;"
                  >
                    <input type="checkbox" id="p_isFamilyMustHave" disabled />
                    家庭必备（自动，根据特价）
                  </label>
                  <label
                    style="font-size: 12px; color: #e5e7eb; margin-right: 10px;"
                  >
                    <input type="checkbox" id="p_isBestSeller" disabled />
                    畅销产品（自动，销量前200）
                  </label>
                  <label
                    style="font-size: 12px; color: #e5e7eb; margin-right: 10px;"
                  >
                    <input type="checkbox" id="p_isNewArrival" disabled />
                    新品上市（自动，一周内最新30）
                  </label>
                </div>

                <!-- 上下架管理 -->
                <div class="form-row">
                  <label
                    style="font-size: 12px; color: #e5e7eb; margin-right: 8px;"
                  >
                    <input type="checkbox" id="p_isActive" checked />
                    当前是否上架
                  </label>
                  <input
                    id="p_activeFrom"
                    type="datetime-local"
                    placeholder="开始上架时间（可选）"
                  />
                  <input
                    id="p_activeTo"
                    type="datetime-local"
                    placeholder="下架时间（可选）"
                  />
                </div>

                <!-- 描述 -->
                <div class="form-row">
                  <input
                    id="p_desc"
                    class="desc-input"
                    placeholder="商品描述，例如「测试爆品 / 日常高频刚需」"
                  />
                </div>

                <!-- 按钮 -->
                <div style="margin-top: 4px; display: flex; gap: 8px">
                  <button class="admin-btn admin-btn-primary" id="btnSaveProduct">
                    💾 保存
                  </button>
                  <button class="admin-btn admin-btn-ghost" id="btnResetForm">
                    ⟲ 重置
                  </button>
                </div>
              </div>
            </div>

            <!-- tab: 进货 / 成本管理 -->
            <div id="editorTabPurchase" style="display:none;">
              <div class="editor-section-title">进货 / 成本管理</div>
              <div class="editor-section-subtitle">
                输入整箱进价、箱数和每箱数量，自动算出单件成本、总成本和建议零售价，并记录每一批的剩余库存和过期时间。
              </div>

              <div
                id="purchaseDisabledHint"
                class="purchase-summary"
                style="display: none;"
              >
                当前还没有具体商品 ID。请先在「商品信息」中保存商品，保存成功后这里会自动解锁。
              </div>

              <div id="purchaseEnabledBox" style="display:none;">
                <div class="purchase-summary" id="purchaseCalcSummary">
                  输入整箱进价、箱数和每箱数量后，会自动计算：<br />
                  单件成本、总件数、总成本和建议零售价。
                </div>

                <!-- 进货表单 -->
                <div class="form-row">
                  <div class="field-block">
                    <div class="field-label">该商品</div>
                    <div
                      id="purchaseProductLabel"
                      style="font-size:12px;color:#e5e7eb;"
                    >
                      （未选择）
                    </div>
                    <div class="field-help">
                      在商品列表点击「进货/成本」或先在「商品信息」保存商品后再切换到此 tab。
                    </div>
                  </div>
                </div>

                <div class="form-row">
                  <div class="field-block">
                    <div class="field-label">进货公司</div>
                    <input
                      id="pb_supplierName"
                      placeholder="例如：XX 批发公司 / XX 超市"
                    />
                  </div>

                  <div class="field-block">
                    <div class="field-label">进货公司 ID</div>
                    <input
                      id="pb_supplierCompanyId"
                      placeholder="例如：SUP-001 / 供货商编码"
                    />
                    <div class="field-help">
                      和供货商系统里的编码保持一致，记录在每一批进货中。
                    </div>
                  </div>
                </div>

                <div class="form-row">
                  <div class="field-block">
                    <div class="field-label">整箱进价（$）</div>
                    <input
                      id="pb_boxPrice"
                      type="number"
                      step="0.01"
                      placeholder="例如：100（整箱总价）"
                    />
                  </div>

                  <div class="field-block">
                    <div class="field-label">进货箱数</div>
                    <input
                      id="pb_boxCount"
                      type="number"
                      step="1"
                      placeholder="例如：10"
                    />
                  </div>

                  <div class="field-block">
                    <div class="field-label">每箱几包</div>
                    <input
                      id="pb_unitsPerBox"
                      type="number"
                      step="1"
                      placeholder="例如：10"
                    />
                  </div>
                </div>

                <div class="form-row">
                  <div class="field-block">
                    <div class="field-label">毛利率（%）</div>
                    <input
                      id="pb_grossMarginPercent"
                      type="number"
                      step="1"
                      placeholder="例如：40 表示毛利率 40%"
                    />
                    <div class="field-help">
                      用于反推建议零售价，计算公式：零售价 = 成本 / (1 - 毛利率)。
                    </div>
                  </div>

                  <div class="field-block">
                    <div class="field-label">该批次过期时间（可选）</div>
                    <input id="pb_expireAt" type="date" />
                  </div>
                </div>

                <div class="form-row">
                  <div class="field-block">
                    <div class="field-label">单件成本（自动）</div>
                    <input
                      id="pb_unitCost"
                      type="text"
                      readonly
                      placeholder="自动计算"
                    />
                  </div>

                  <div class="field-block">
                    <div class="field-label">本批次总件数（自动）</div>
                    <input
                      id="pb_totalUnits"
                      type="text"
                      readonly
                      placeholder="自动计算"
                    />
                  </div>

                  <div class="field-block">
                    <div class="field-label">本批次总成本（自动）</div>
                    <input
                      id="pb_totalCost"
                      type="text"
                      readonly
                      placeholder="自动计算"
                    />
                  </div>
                </div>

                <div class="form-row">
                  <div class="field-block">
                    <div class="field-label">建议零售价（可编辑）</div>
                    <input
                      id="pb_retailPrice"
                      type="number"
                      step="0.01"
                      placeholder="自动带出，可手动调整"
                    />
                    <div class="field-help">
                      保存后会自动同步到左侧的「原价」，并把本批次数量叠加到库存。
                    </div>
                  </div>
                </div>

                <div style="margin-top: 4px; display: flex; gap: 8px">
                  <button
                    class="admin-btn admin-btn-primary"
                    id="btnSavePurchaseBatch"
                    type="button"
                  >
                    📦 保存本次进货批次
                  </button>
                  <button
                    class="admin-btn admin-btn-ghost"
                    id="btnResetPurchaseForm"
                    type="button"
                  >
                    ⟲ 清空进货表单
                  </button>
                </div>

                <!-- 批次记录列表 -->
                <div style="margin-top: 10px;">
                  <div class="editor-section-title">历史进货批次记录</div>
                  <div class="editor-section-subtitle">
                    显示该商品所有批次的进价、剩余库存和过期时间，仅存在于内存中（重启会清空）。
                  </div>

                  <div class="purchase-table-wrapper">
                    <table class="purchase-table">
                      <thead>
                        <tr>
                          <th>时间</th>
                          <th>进货公司</th>
                          <th>进货公司ID</th>
                          <th>箱价</th>
                          <th>箱数</th>
                          <th>每箱数量</th>
                          <th>总件数</th>
                          <th>单件成本</th>
                          <th>总成本</th>
                          <th>毛利率</th>
                          <th>零售价</th>
                          <th>过期时间</th>
                          <th>剩余库存</th>
                        </tr>
                      </thead>
                      <tbody id="purchaseBatchTableBody">
                        <tr>
                          <td colspan="13" style="text-align:center;color:#6b7280;">
                            当前暂无进货记录
                          </td>
                        </tr>
                      </tbody>
                    </table>
                  </div>
                </div>
              </div>
            </div>
          </section>
        </main>
      </div>
    </div>
    <script src="/admin/assets/js/admin_guard.js"></script>
    <script src="./assets/js/admin_auth_ui.js"></script>
    <!-- ✅ 统一 sidebar 注入脚本（必须加） -->
    <script src="/admin/assets/js/admin_sidebar.js"></script>
    <!-- 通用后台脚本 -->
    <script src="assets/js/admin.js"></script>
    <!-- 当前页的业务脚本：把原来内联的 JS 全部放到这里 -->
    <script src="assets/js/products.js"></script>
  </body>
</html>
