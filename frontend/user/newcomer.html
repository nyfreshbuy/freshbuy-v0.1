<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <title>æ–°å®¢ä½“éªŒä¸“åŒº - åœ¨é²œè´­</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="/user/assets/css/main.css?v=10" />

  <style>
    :root{
      --topbar-h: 0px; /* JS è‡ªåŠ¨å†™å…¥ */
      --app-shadow: 0 6px 18px rgba(15,23,42,.10);
    }

    /* âœ… é¡¶éƒ¨åŒæ’å›ºå®š */
    .top-fixed{
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      z-index: 99990;
      background:#fff;
      border-bottom:1px solid #eef2f7;
      padding-top: env(safe-area-inset-top);
    }
    .top-fixed.is-scrolled{ box-shadow: var(--app-shadow); }

    .top-row{
      max-width: 1400px;
      margin: 0 auto;
      padding: 10px 14px;
      display:flex;
      align-items:center;
      gap:12px;
      justify-content:space-between;
    }

    .logo-area{display:flex; align-items:center; gap:8px; cursor:pointer;}
    .logo-badge{
      width:32px;height:32px;border-radius:999px;
      background: radial-gradient(circle at 30% 30%, #22c55e, #16a34a);
      display:flex;align-items:center;justify-content:center;color:#fff;font-weight:800;
      flex: 0 0 auto;
    }
    .logo-text-main{font-weight:900;}

    .right-actions{display:flex; align-items:center; gap:10px;}
    .back-btn{
      padding:8px 12px;
      border-radius:999px;
      border:1px solid #e5e7eb;
      background:#fff;
      font-size:13px;
      font-weight:700;
      cursor:pointer;
      white-space:nowrap;
    }

    .cart-icon{
      position:relative;
      width:38px;height:38px;border-radius:999px;
      background:#0f172a;
      display:flex;align-items:center;justify-content:center;
      color:#e5e7eb; cursor:pointer;
      user-select:none;
      flex: 0 0 auto;
    }
    .cart-count-badge{
      position:absolute; top:-4px; right:-4px;
      background:#ef4444; color:#fff;
      font-size:10px; padding:0 6px;
      border-radius:999px; min-width:20px;
      text-align:center; display:none;
    }

    /* âœ… ç¬¬äºŒæ’ï¼šåˆ†ç±» + æ’åº */
    .filter-row{
      max-width: 1400px;
      margin: 0 auto;
      padding: 8px 14px 10px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      border-top:1px solid #f3f4f6;
    }
    .filter-bar{
      display:flex; gap:8px;
      overflow-x:auto;
      -webkit-overflow-scrolling: touch;
      padding-bottom:2px;
      flex: 1 1 auto;
    }
    .filter-bar::-webkit-scrollbar{display:none;}

    .filter-pill{
      flex:0 0 auto;
      padding:8px 12px;
      border-radius:999px;
      border:1px solid #e5e7eb;
      background:#fff;
      font-size:13px;
      font-weight:700;
      cursor:pointer;
      white-space:nowrap;
    }
    .filter-pill.active{
      border-color:rgba(34,197,94,.9);
      background:linear-gradient(135deg,#ecfdf3,#dcfce7);
      color:#15803d;
      font-weight:900;
    }

    .sort-box{
      flex:0 0 auto;
      display:flex; align-items:center; gap:6px;
      font-size:12px; color:#6b7280;
      white-space:nowrap;
    }
    .sort-select{
      padding:8px 10px;
      border-radius:10px;
      border:1px solid #e5e7eb;
      background:#fff;
      font-size:13px;
      outline:none;
      font-weight:800;
    }

    /* âœ… ä¸»ä½“è®©ä½ç»™é¡¶éƒ¨ fixed */
    main.page{
      max-width:1400px;
      margin:0 auto;
      padding: 14px 14px 30px;
      padding-top: calc(var(--topbar-h) + 12px) !important;
    }
    .page-title{
      display:flex; align-items:flex-end; justify-content:space-between;
      gap:10px; margin:6px 0 10px;
    }
    .page-title h2{margin:0; font-size:18px;}
    .page-title .sub{color:#6b7280; font-size:12px;}

    /* âœ… toastï¼šåœ¨é¡¶éƒ¨åŒæ’ä¸‹é¢ */
    .add-cart-toast{
      position:fixed;
      top: calc(env(safe-area-inset-top) + var(--topbar-h) + 8px);
      left:50%;
      transform:translateX(-50%) translateY(-16px);
      background:#111827; color:#f9fafb;
      padding:6px 14px; border-radius:999px; font-size:12px;
      box-shadow:0 8px 20px rgba(15,23,42,.25);
      opacity:0; pointer-events:none;
      transition: opacity .25s ease, transform .25s ease;
      z-index: 999999;
      white-space:nowrap;
    }
    .add-cart-toast.show{opacity:1; transform:translateX(-50%) translateY(0);}

    /* ======================
       âœ… è´­ç‰©è½¦æŠ½å±‰ï¼ˆå…³é”®ï¼šä¸å†â€œåªç°å±â€ï¼‰
       ====================== */
    .cart-backdrop{
      position:fixed;
      inset:0;
      background:rgba(15,23,42,.45);
      display:none;
      z-index:99995;
    }
    .cart-backdrop.active{display:block;}

    .cart-drawer{
      position:fixed;
      right:0;
      top:0;
      height:100vh;
      width:360px;
      max-width:92vw;
      background:#fff;
      border-left:1px solid #eef2f7;
      box-shadow:-12px 0 30px rgba(15,23,42,.18);
      transform:translateX(110%);
      transition:transform .25s ease;
      z-index:99996;
      display:flex;
      flex-direction:column;
    }
    .cart-drawer.active{transform:translateX(0);}

    .cart-drawer-header{
      padding:12px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      border-bottom:1px solid #eef2f7;
      font-weight:900;
    }
    .cart-close-btn{
      width:36px;height:36px;
      border-radius:12px;
      border:1px solid #e5e7eb;
      background:#fff;
      cursor:pointer;
      font-weight:900;
    }
    .cart-drawer-body{padding:12px; overflow:auto; flex:1;}
    .cart-empty{padding:12px; color:#6b7280; font-size:13px;}
    .cart-items{display:flex; flex-direction:column; gap:10px;}
    .cart-drawer-footer{padding:12px; border-top:1px solid #eef2f7;}
    .cart-go-btn{
      width:100%;
      height:46px;
      border:none;
      border-radius:14px;
      background:#0f172a;
      color:#fff;
      font-weight:900;
      cursor:pointer;
    }

    @media (max-width: 520px){
      .top-row{padding:10px 12px;}
      .filter-row{padding:8px 12px 10px;}
      main.page{padding-left:12px; padding-right:12px;}
    }
    /* âœ… å¼ºè¡Œå…œåº•ï¼šé¿å… main.css æŠŠæŠ½å±‰éšè—æˆ–å±‚çº§ç›–ä½ */
#cartBackdrop{
  display:none !important;
  z-index:99995 !important;
}
#cartBackdrop.active{
  display:block !important;
}

#cartDrawer{
  display:flex !important;              /* é¿å…è¢« main.css display:none */
  z-index:99996 !important;
  transform:translateX(110%) !important;/* é»˜è®¤åœ¨å±å¹•å¤– */
}
#cartDrawer.active{
  transform:translateX(0) !important;   /* æ‰“å¼€æ—¶æ»‘å…¥ */
}
  </style>
</head>

<body>

  <!-- âœ… å›ºå®šé¡¶éƒ¨åŒæ’ -->
  <div class="top-fixed" id="topFixed">
    <div class="top-row">
      <div class="logo-area" onclick="location.href='/user/index.html'">
        <div class="logo-badge">é²œ</div>
        <div>
          <div class="logo-text-main">æ–°å®¢ä½“éªŒä¸“åŒº</div>
          <div style="font-size:11px;color:#6b7280;">å…è´¹é…é€ Â· æ— é—¨æ§› Â· 0å…ƒèµ·é€</div>
        </div>
      </div>

      <div class="right-actions">
        <button type="button" class="back-btn" onclick="location.href='/user/index.html'">â† è¿”å›é¦–é¡µ</button>

        <div class="cart-icon" id="cartIcon" title="æ‰“å¼€è´­ç‰©è½¦">
          ğŸ›’
          <span class="cart-count-badge" id="cartCount">0</span>
        </div>
      </div>
    </div>

    <div class="filter-row">
      <div class="filter-bar" id="filterBar"></div>
      <div class="sort-box">
        <span>æ’åº</span>
        <select class="sort-select" id="sortSelect">
          <option value="sales_desc">é”€é‡é«˜ â†’ ä½</option>
          <option value="price_asc">ä»·æ ¼ä½ â†’ é«˜</option>
          <option value="price_desc">ä»·æ ¼é«˜ â†’ ä½</option>
        </select>
      </div>
    </div>
  </div>

  <div class="add-cart-toast" id="addCartToast">å·²åŠ å…¥è´­ç‰©è½¦</div>

  <main class="page">
    <div class="page-title">
      <div>
        <h2>ğŸ”¥ çˆ†å“ä¸“åŒº</h2>
        <div class="sub">åªå±•ç¤ºçˆ†å“ï¼ˆHot Deals / çˆ†å“æ ‡ç­¾ / isHotï¼‰</div>
      </div>
    </div>

    <div class="product-grid" id="newcomerGrid"></div>
  </main>

  <!-- âœ… è´­ç‰©è½¦æŠ½å±‰ DOMï¼ˆå¿…é¡»æœ‰ï¼Œå¦åˆ™ä¼šå‡ºç°â€œåªç°å±â€ï¼‰ -->
  <div class="cart-backdrop" id="cartBackdrop"></div>

  <aside class="cart-drawer" id="cartDrawer" aria-hidden="true">
    <div class="cart-drawer-header">
      <div>è´­ç‰©è½¦</div>
      <button type="button" class="cart-close-btn" id="cartCloseBtn">âœ•</button>
    </div>

    <div class="cart-drawer-body">
      <div style="font-size:12px;color:#6b7280; margin-bottom:10px;">
        å…± <span id="cartTotalItems">0</span> ä»¶
      </div>

      <div class="cart-empty" id="cartEmptyText" style="display:none;">
        è´­ç‰©è½¦è¿˜æ˜¯ç©ºçš„ï¼Œå¿«å»æŒ‘ç‚¹å¥½ä¸œè¥¿ï½
      </div>

      <div class="cart-items" id="cartItemsList"></div>
    </div>

    <div class="cart-drawer-footer">
      <button type="button" class="cart-go-btn" id="goCartBtn">å»è´­ç‰©è½¦ç»“ç®—</button>
    </div>
  </aside>

  <!-- âœ… è„šæœ¬é¡ºåºï¼šcart â†’ renderer â†’ page -->
  <script src="/user/assets/js/cart.js?v=10"></script>
  <script src="/user/assets/js/product_card_renderer.js?v=2"></script>
  <script src="/user/assets/js/newcomer.js?v=12"></script>

  <!-- âœ… è‡ªåŠ¨è®¡ç®—é¡¶éƒ¨é«˜åº¦ + æ»šåŠ¨é˜´å½± -->
  <script>
    (function () {
      const top = document.getElementById("topFixed");
      if (!top) return;

      function applyHeight() {
        const h = Math.ceil(top.getBoundingClientRect().height || 0);
        document.documentElement.style.setProperty("--topbar-h", h + "px");
      }

      function onScroll() {
        if (window.scrollY > 4) top.classList.add("is-scrolled");
        else top.classList.remove("is-scrolled");
      }

      applyHeight();
      onScroll();

      window.addEventListener("resize", applyHeight, { passive: true });
      window.addEventListener("orientationchange", applyHeight, { passive: true });
      window.addEventListener("scroll", onScroll, { passive: true });
    })();
    
  </script>
  <script>
  // âœ… æœ¬é¡µå…œåº•ï¼šå¦‚æœå‡ºç°â€œåªç°å±ï¼ŒæŠ½å±‰ä¸å‡ºâ€ï¼Œå°±å¼ºåˆ¶æ‰“å¼€æŠ½å±‰
  (function () {
    const $ = (id) => document.getElementById(id);

    function openCart() {
      const bd = $("cartBackdrop");
      const dr = $("cartDrawer");
      if (bd) bd.classList.add("active");
      if (dr) dr.classList.add("active");
      if (dr) dr.setAttribute("aria-hidden", "false");
    }

    function closeCart() {
      const bd = $("cartBackdrop");
      const dr = $("cartDrawer");
      if (bd) bd.classList.remove("active");
      if (dr) dr.classList.remove("active");
      if (dr) dr.setAttribute("aria-hidden", "true");
    }

    function toggleCart() {
      const bd = $("cartBackdrop");
      const dr = $("cartDrawer");
      const bdOn = bd && bd.classList.contains("active");
      const drOn = dr && dr.classList.contains("active");

      // âœ… åªç°å±ï¼ˆbdOn=true ä½† drOn=falseï¼‰=> ç›´æ¥ä¿®å¤ä¸ºæ‰“å¼€æŠ½å±‰
      if (bdOn && !drOn) {
        openCart();
        return;
      }

      if (bdOn || drOn) closeCart();
      else openCart();
    }

    document.addEventListener("DOMContentLoaded", () => {
      const icon = $("cartIcon");
      const bd = $("cartBackdrop");
      const closeBtn = $("cartCloseBtn");

      if (icon) {
        icon.addEventListener("click", (e) => {
          e.preventDefault();
          e.stopPropagation();
          toggleCart();
        });
      }

      if (bd) bd.addEventListener("click", closeCart);
      if (closeBtn) closeBtn.addEventListener("click", closeCart);

      window.addEventListener("keydown", (e) => {
        if (e.key === "Escape") closeCart();
      });
    });
  })();
</script>
</body>
</html>
