<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <title>ç•…é”€äº§å“ - åœ¨é²œè´­</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="/user/assets/css/main.css?v=10" />

  <style>
    :root{
      --best-top-h: 120px; /* JS ä¼šåŠ¨æ€è¦†ç›–çœŸå®é«˜åº¦ */
      --app-shadow: 0 6px 16px rgba(15,23,42,.10);
    }

    /* âœ… iOS/å¾®ä¿¡ï¼šç¥–å…ˆ transform ä¼šå¯¼è‡´ fixed å¤±æ•ˆï¼ˆè·Ÿç€æ»šï¼‰
       æœ¬é¡µå…œåº•è§£é™¤ */
    html, body{
      transform: none !important;
      filter: none !important;
      perspective: none !important;
      contain: none !important;
    }

    /* âœ… ä¸¤æ’ä¸€èµ·å›ºå®šåœ¨é¡¶éƒ¨ï¼ˆæ ‡é¢˜+è´­ç‰©è½¦ + åˆ†ç±»+æ’åºï¼‰ */
    .top-nav{
      position: fixed !important;
      top: 0 !important;
      left: 0 !important;
      right: 0 !important;

      z-index: 9999 !important;
      background:#fff;
      border-bottom:1px solid #eef2f7;

      /* iPhone åˆ˜æµ·å®‰å…¨åŒº */
      padding-top: env(safe-area-inset-top);
      transition: box-shadow .2s ease;
    }
    .top-nav.is-scrolled{
      box-shadow: var(--app-shadow);
    }

    .top-nav-inner{
      max-width: 1400px;
      margin:0 auto;
      padding:10px 14px;
      display:flex;
      align-items:center;
      gap:12px;
      justify-content:space-between;
    }

    .logo-area{display:flex; align-items:center; gap:8px;}
    .logo-badge{
      width:32px;height:32px;border-radius:999px;
      background: radial-gradient(circle at 30% 30%, #22c55e, #16a34a);
      display:flex;align-items:center;justify-content:center;
      color:#fff;font-weight:800;
      box-shadow: 0 8px 18px rgba(34,197,94,.18);
    }
    .logo-text-main{font-weight:800;}
    .right-actions{display:flex; align-items:center; gap:10px;}

    .cart-icon{
      position:relative;
      width:38px;height:38px;border-radius:999px;
      background:#0f172a;
      display:flex;align-items:center;justify-content:center;
      color:#e5e7eb;
      cursor:pointer;
      user-select:none;
    }
    .cart-count-badge{
      position:absolute; top:-4px; right:-4px;
      background:#ef4444; color:#fff;
      font-size:10px; padding:0 6px;
      border-radius:999px; min-width:20px;
      text-align:center;
      display:none;
    }

    /* âœ… ç¬¬äºŒæ’ï¼šåˆ†ç±» + æ’åºï¼ˆä¹Ÿåœ¨ fixed é‡Œï¼‰ */
    .filter-wrap{
      max-width:1400px;
      margin:0 auto;
      padding:8px 14px 10px;
      display:flex;
      gap:10px;
      align-items:center;
      justify-content:space-between;

      border-top:1px solid #f3f4f6;
      background:#fff;
    }

    .filter-bar{
      display:flex;
      gap:8px;
      overflow-x:auto;
      padding-bottom:2px;
      -webkit-overflow-scrolling: touch;
      flex: 1 1 auto;
      min-width: 0;
      touch-action: pan-x;
    }
    .filter-bar::-webkit-scrollbar{display:none;}

    .filter-pill{
      flex:0 0 auto;
      padding:8px 12px;
      border-radius:999px;
      border:1px solid #e5e7eb;
      background:#fff;
      font-size:13px;
      cursor:pointer;
      white-space:nowrap;
    }
    .filter-pill.active{
      border-color:rgba(34,197,94,.9);
      background:linear-gradient(135deg,#ecfdf3,#dcfce7);
      color:#15803d;
      font-weight:800;
    }

    .sort-box{
      flex:0 0 auto;
      display:flex;
      align-items:center;
      gap:6px;
      font-size:12px;
      color:#6b7280;
      white-space:nowrap;
    }
    .sort-select{
      padding:8px 10px;
      border-radius:10px;
      border:1px solid #e5e7eb;
      background:#fff;
      font-size:13px;
      outline:none;
      font-weight:800;
    }

    /* âœ… ä¸»ä½“ï¼šç»™ fixed çš„ä¸¤æ’é¡¶éƒ¨è®©ä½ */
    .page{
      max-width:1400px;
      margin:0 auto;
      padding:14px 14px 30px;
      padding-top: calc(var(--best-top-h) + 10px) !important;
    }

    .page-title{
      display:flex;
      align-items:flex-end;
      justify-content:space-between;
      gap:10px;
      margin:6px 0 10px;
    }
    .page-title h2{margin:0; font-size:18px;}
    .page-title .sub{color:#6b7280; font-size:12px;}

    .add-cart-toast{
      position:fixed;
      top: calc(env(safe-area-inset-top) + 70px);
      left:50%;
      transform:translateX(-50%) translateY(-16px);
      background:#111827;
      color:#f9fafb;
      padding:6px 14px;
      border-radius:999px;
      font-size:12px;
      box-shadow:0 8px 20px rgba(15,23,42,.4);
      opacity:0;
      pointer-events:none;
      transition: opacity .25s ease, transform .25s ease;
      z-index:10000;
      white-space:nowrap;
    }
    .add-cart-toast.show{
      opacity:1;
      transform:translateX(-50%) translateY(0);
    }

    @media (max-width: 520px){
      .top-nav-inner{padding:10px 12px;}
      .filter-wrap{padding:8px 12px 10px;}
      .page{padding-left:12px; padding-right:12px;}
    }
  </style>
</head>

<body>
  <header class="top-nav">
    <div class="top-nav-inner">
      <div class="logo-area" onclick="location.href='/user/index.html'" style="cursor:pointer;">
        <div class="logo-badge">é²œ</div>
        <div>
          <div class="logo-text-main">ç•…é”€äº§å“ä¸“åŒº</div>
          <div style="font-size:11px;color:#6b7280;">TOP çƒ­é”€ Â· å£ç¢‘ä¹‹é€‰ Â· å›è´­æœ€å¤š</div>
        </div>
      </div>

      <div class="right-actions">
        <button
          type="button"
          onclick="location.href='/user/index.html'"
          style="
            padding:8px 12px;
            border-radius:999px;
            border:1px solid #e5e7eb;
            background:#fff;
            font-size:13px;
            font-weight:600;
            cursor:pointer;
            white-space:nowrap;
          "
        >
          â† è¿”å›é¦–é¡µ
        </button>

        <div class="cart-icon" id="cartIcon" title="æ‰“å¼€è´­ç‰©è½¦">
          ğŸ›’
          <span class="cart-count-badge" id="cartCount">0</span>
        </div>
      </div>
    </div>

    <div class="filter-wrap">
      <div class="filter-bar" id="filterBar"></div>
      <div class="sort-box">
        <span>æ’åº</span>
        <select class="sort-select" id="sortSelect">
          <option value="sales_desc">é”€é‡é«˜ â†’ ä½</option>
          <option value="price_asc">ä»·æ ¼ä½ â†’ é«˜</option>
          <option value="price_desc">ä»·æ ¼é«˜ â†’ ä½</option>
        </select>
      </div>
    </div>
  </header>

  <div class="add-cart-toast" id="addCartToast">å·²åŠ å…¥è´­ç‰©è½¦</div>

  <main class="page">
    <div class="page-title">
      <div>
        <h2>ğŸ† ç•…é”€äº§å“</h2>
        <div class="sub">åªå±•ç¤ºç•…é”€/çƒ­é”€/Top/Best ç­‰æ ‡ç­¾æˆ– isBest æ ‡è®°çš„å•†å“</div>
      </div>
    </div>

    <div class="product-grid" id="bestGrid"></div>
  </main>

  <!-- âœ… è„šæœ¬é¡ºåºï¼šcart â†’ renderer â†’ best -->
  <script src="/user/assets/js/cart.js?v=10"></script>
  <script src="/user/assets/js/product_card_renderer.js?v=2"></script>
  <script src="/user/assets/js/Best.js?v=1"></script>

  <!-- âœ… è‡ªåŠ¨è®¡ç®— fixed é¡¶éƒ¨é«˜åº¦ï¼Œè®© main.page ä¸è¢«ç›–ä½ + æ»šåŠ¨é˜´å½± -->
  <script>
    (function () {
      const top = document.querySelector(".top-nav");
      if (!top) return;

      function applyHeight(){
        const h = Math.ceil(top.getBoundingClientRect().height || 0);
        document.documentElement.style.setProperty("--best-top-h", h + "px");
      }

      function onScroll(){
        if (window.scrollY > 4) top.classList.add("is-scrolled");
        else top.classList.remove("is-scrolled");
      }

      applyHeight();
      onScroll();

      window.addEventListener("resize", applyHeight, { passive: true });
      window.addEventListener("orientationchange", applyHeight, { passive: true });
      window.addEventListener("scroll", onScroll, { passive: true });
    })();
  </script>
</body>
</html>
